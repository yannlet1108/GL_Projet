@startuml classe_conception

' ======================================================
' ==                    MODÈLE (M)                   ==
' ======================================================
 
package "Modèle" {

    class Utilisateur {
        - id : int
        - nom : String
        - email : String
        - passwordHash : String
        --
        + connecter(mdp : String) : boolean
    }

    class Univers {
        - id : int
        - nom : String
        - description : String
    }

    class Personnage {
        - id : int
        - nom : String
        - dateNaissance : String
        - profession : String
        - portrait : Image
        - isValide : boolean
        --
        - joueur : Utilisateur
        - MJ : Utilisateur
        - mjEnAttenteChangement : Utilisateur
        - univers : Univers
        - biographie : Biographie
        --
        + 
        + isValide() : boolean
        + validerParMJ(utilisateur : Utilisateur) : boolean
        + appartientAUnivers(univers : Univers) : boolean
        + appartientAJoueur(utilisateur : Utilisateur) : boolean
        + aMemeJoueur(personnage : Personnage) : boolean
        + estDansPartieEnCours() : boolean  // pour vérifier si changement MJ possible
        + changerProfession(nouvelleProfession : String) : void
        + peutChangerMJ() : boolean
        + demanderChangementMJ(nouveauMJ : Utilisateur) : void
        + accepterChangementMJ(utilisateur : Utilisateur) : boolean  // vérifie que c'est bien le MJ en attente
        + refuserChangementMJ(utilisateur : Utilisateur) : boolean
        + cederPersonnage(nouveauJoueur : Utilisateur, demandeur : Utilisateur) : boolean
        + getAventures() : List<Aventure>
    }

    class Biographie {
        - id : int
        --
        - personnage : Personnage
        - episodes : List<Episode>
        --
        + ajouterEpisode(ep:Episode)
        + supprimerEpisode(ep:Episode)
        + validerEpisode(ep:Episode)
        + getEpisodesVisiblesPar(utilisateur : Utilisateur) : List<Episode>
    }

    class Episode {
        - id : int
        - titre : String
        - dateRelative : String
        - isValideParMJ : boolean
        - isValideParJoueur : boolean
        --
        - paragraphes : List<Paragraphe>
        - aventure : Aventure
        - statut : StatutEpisode
        --
        + isModifiablePar(utilisateur : Utilisateur) : boolean
        + validerParJoueur(utilisateur : Utilisateur) : boolean
        + validerParMJ(utilisateur : Utilisateur) : boolean
        + isCompletementValide() : boolean
        + ajouterParagraphe(p : Paragraphe) : void
        + retirerParagraphe(p : Paragraphe) : void
    }

    enum StatutEpisode {
        BROUILLON
        EN_ATTENTE_VALIDATION
        VALIDE
    }

    class Paragraphe {
        - id : int
        - ordre : int
        - texte : String
        - isPublique : boolean
        --
        + isPublique() : boolean
        + isVisiblePar(utilisateur : Utilisateur) : boolean
        + rendrePublic(utilisateur : Utilisateur) : boolean
    }

    class Aventure {
        - id : int
        - titre : String
        - resume : String
        --
        - univers : Univers
        - personnages : List<Personnage>
        --
    }

    class Partie {
        - id : int
        - titre : String
        - situationInitiale : String
        - date : Date
        - lieu : String
        - terminee : boolean
        --
        - univers : Univers
        - MJ : Utilisateur
        - personnages : List<Personnage>
        - aventureGeneree : Aventure
        --
        + isPersonnageAjoutable(personnage : Personnage) : boolean
        + ajouterPersonnage(p:Personnage)
        + retirerPersonnage(p:Personnage)
        + terminerPartie(resume:String) : Aventure
        + isModifiable() : boolean
        + supprimerProposition()
    }

    Personnage "1" o-- "1" Biographie
    Personnage "1" --> "1" Utilisateur : propriétaire
    Personnage "0..1" --> "1" Utilisateur : MJ
    Personnage "1" --> "1" Univers

    Biographie "1" *-- "1..*" Episode

    Episode "0..*" --> "0..1" Aventure
    Episode "1" *-- "1..*" Paragraphe

    Partie "1" --> "1" Utilisateur : MJ
    Partie "0..*" --> "0..*" Personnage : participants
    Partie "1" --> "1" Univers
    Partie "0..1" --> "0..1" Aventure : génère >

    Aventure "0..*" --> "0..*" Personnage : participants

}

newpage
' ======================================================
' ==                CONTRÔLEURS (C)                   ==
' ======================================================

package "Contrôleurs" {

    class PersonnageController {
        + creerPersonnage(nom : String, dateNaissance : String, profession : String, bioInitiale : String, utilisateurConnecte : Utilisateur) : Personnage
        + listerTous() : List<Personnage>
        + listerParUtilisateur(u : Utilisateur) : List<Personnage>
        + findById(id : int) : Personnage
        + modifierProfession(idPers : int, nvProfession : String, utilisateurConnecte : Utilisateur) : boolean
        + cederPersonnage(idPers : int, idNewJoueur : int, utilisateurConnecte : Utilisateur) : boolean
        + demanderChangementMJ(idPers : int, idNewMJ : int, utilisateurConnecte : Utilisateur) : boolean
        + accepterChangementMJ(idPers : int, utilisateurConnecte : Utilisateur) : boolean
        + refuserChangementMJ(idPers : int, utilisateurConnecte : Utilisateur) : boolean
    }

    class BiographieController {
        - episodeController : EpisodeController
        - personnageController : PersonnageController             
    }

    class EpisodeController {
        - personnageController : PersonnageController
        - authController : AuthController
        --
        + creerEpisode(idPers : int, titre : String, dateRelative : String, utilisateurConnecte : Utilisateur) : Episode
        + modifierEpisode(idEp : int, titre : String, dateRelative : String, utilisateurConnecte : Utilisateur) : boolean
        + ajouterParagraphe(idEp : int, texte : String, estSecret : boolean, ordre : int, utilisateurConnecte : Utilisateur) : boolean
        + supprimerParagraphe(idPar : int, utilisateurConnecte : Utilisateur) : boolean
        + validerEpisode(idEp : int, utilisateurConnecte : Utilisateur) : boolean
        + supprimerEpisode(idEp : int, utilisateurConnecte : Utilisateur) : boolean
        + revelerParagraphe(idPar : int, utilisateurConnecte : Utilisateur) : boolean
        + findEpisodeById(idEp : int) : Episode
        + findParagrapheById(idPar : int) : Paragraphe
    }

    class PartieController {
        - personnageController : PersonnageController
        - authController : AuthController
        --
        + creerPartie(titre : String, situationInitiale : String, lieu : String, utilisateurConnecte : Utilisateur) : Partie
        + listerPartiesEnCours() : List<Partie>
        + listerParMJ(mj : Utilisateur) : List<Partie>
        + ajouterParticipant(idPartie : int, personnage : Personnage, utilisateurConnecte : Utilisateur) : boolean
        + retirerParticipant(idPartie : int, personnage : Personnage, utilisateurConnecte : Utilisateur) : boolean
        + terminerPartie(idPartie : int, resume : String, utilisateurConnecte : Utilisateur) : boolean
        + supprimerPartie(idPartie : int, utilisateurConnecte : Utilisateur) : boolean
    }

    class AuthController {
        + login(email : String, mdp : String) : Utilisateur
        + logout() : void
        + register(nom : String, email : String, mdp : String) : Utilisateur
        + getUtilisateurConnecte() : Utilisateur
    }

}
' Invisible vertical connectors so controllers render one above another
PersonnageController -[#white]-> BiographieController
BiographieController -[#white]-> EpisodeController
EpisodeController -[#white]-> PartieController
PartieController -[#white]-> AuthController


newpage
' ======================================================
' ==                    VUES (V)                      ==
' ======================================================

package "Vues" {
    class VuePersonnage{
        - 
        + afficherPersonnage(idPers, utilisateurConnecte : Utilisateur) : void
        + listerPersonnages(utilisateurConnecte : Utilisateur) : void
    }
    class VueBiographie{
        + afficherBiographie(idPers, utilisateurConnecte : Utilisateur) : void
    }
    class VuePartie{
        + afficherPartie(idPartie, utilisateurConnecte : Utilisateur) : void
        + listerParties(utilisateurConnecte : Utilisateur) : void
    }
    class VueEpisode{
        + afficherEpisode(idEp, utilisateurConnecte : Utilisateur) : void
    }
    class VueConnexion{

    }
}

@enduml
